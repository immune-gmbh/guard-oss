---
$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://immune.app/schemas/issuesv1.schema.yaml"

type: object
anyOf:
 - { $ref: "#/$defs/csme-no-update" }
 - { $ref: "#/$defs/csme-downgrade" }
 - { $ref: "#/$defs/uefi-option-rom-set" }
 - { $ref: "#/$defs/uefi-boot-app-set" }
 - { $ref: "#/$defs/uefi-ibb-no-update" }
 - { $ref: "#/$defs/uefi-no-exit-boot-srv" }
 - { $ref: "#/$defs/uefi-gpt-changed" }
 - { $ref: "#/$defs/uefi-secure-boot-keys" }
 - { $ref: "#/$defs/uefi-secure-boot-variables" }
 - { $ref: "#/$defs/uefi-secure-boot-dbx" }
 - { $ref: "#/$defs/uefi-official-dbx" }
 - { $ref: "#/$defs/uefi-boot-failure" }
 - { $ref: "#/$defs/uefi-boot-order" }
 - { $ref: "#/$defs/tpm-endorsement-cert-unverified" }
 - { $ref: "#/$defs/tpm-no-eventlog" }
 - { $ref: "#/$defs/tpm-invalid-eventlog" }
 - { $ref: "#/$defs/tpm-dummy" }
 - { $ref: "#/$defs/grub-boot-changed" }
 - { $ref: "#/$defs/eset-disabled" }
 - { $ref: "#/$defs/eset-not-started" }
 - { $ref: "#/$defs/eset-excluded-set" }
 - { $ref: "#/$defs/eset-manipulated" }
 - { $ref: "#/$defs/windows-boot-config" }
 - { $ref: "#/$defs/windows-boot-log-quotes" }
 - { $ref: "#/$defs/windows-boot-counter-replay" }
 - { $ref: "#/$defs/ima-invalid-log" }
 - { $ref: "#/$defs/ima-boot-aggregate" }
 - { $ref: "#/$defs/ima-runtime-measurements" }
 - { $ref: "#/$defs/tsc-pcr-values" }
 - { $ref: "#/$defs/tsc-endorsement-certificate" }
 - { $ref: "#/$defs/policy-endpoint-protection" }
 - { $ref: "#/$defs/policy-intel-tsc" }
 - { $ref: "#/$defs/firmware-update" }
 - { $ref: "#/$defs/binarly" }

$defs:
  # contents of appraisal field
  issues:
    type: object
    properties:
      # keep in sync w/ issuesv1.New()
      type: { const: "issues/v1" }
      issues:
        type: array
        items: { $ref: "#" }
    required: [ type, issues ]
    additionalProperties: false

  # "base class"
  common:
    type: object
    properties:
      id: { type: string }
      incident: { type: boolean }
      aspect:
        enum:
          - "supply-chain"
          - "firmware"
          - "configuration"
          - "bootloader"
          - "operating-system"
          - "endpoint-protection"
    required: [ id, incident, aspect ]
    additionalProperties: false

  # issues generated by binarly
  binarly:
    comment: |
      Type for all issues found by Binarly. No payload as they're all complex
      vulnerabilities that either are found or not.
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id:
            enum:
              - brly/2021-001-swsmi-len-65529
              - brly/rkloader
              - brly/2021-025
              - brly/2021-037
              - brly/2021-035
              - brly/2021-032
              - brly/2021-023
              - brly/2021-029
              - brly/intel-bssa-dft
              - brly/2021-050
              - brly/2021-051
              - brly/2021-013
              - brly/2021-022
              - brly/2021-024
              - brly/lojax-secdxe
              - brly/usbrt-intel-sa-00057
              - brly/2021-005
              - brly/2021-021
              - brly/moonbounce-core-dxe
              - brly/2021-053
              - brly/2021-028
              - brly/2021-008
              - brly/2021-040
              - brly/2021-020
              - brly/2021-004
              - brly/2021-016
              - brly/usbrt-cve-2017-5721
              - brly/2021-006
              - brly/2021-019
              - brly/2021-009
              - brly/2021-026
              - brly/2021-039
              - brly/2021-010
              - brly/2021-007
              - brly/2021-031
              - brly/mosaicregressor
              - brly/2021-012
              - brly/2021-033
              - brly/2021-036
              - brly/thinkpwn
              - brly/2021-014
              - brly/2021-018
              - brly/2021-038
              - brly/2022-004
              - brly/especter
              - brly/2021-003
              - brly/2021-042
              - brly/usbrt-swsmi-cve-2020-12301
              - brly/2021-043
              - brly/2022-028-rsbstuffing
              - brly/2021-034
              - brly/2021-030
              - brly/2021-041
              - brly/2021-017
              - brly/usbrt-usbsmi-cve-2020-12301
              - brly/2021-027
              - brly/2021-015
              - brly/2021-011
              - brly/2021-045
              - brly/2021-009-1
              - brly/2021-029-1
              - brly/2021-010-1
              - brly/2021-011-1
              - brly/2021-008-1
              - brly/2021-001
              - brly/2022-027
              - brly/2022-014
              - brly/2022-011
              - brly/2022-013
              - brly/2022-016
              - brly/2021-047
              - brly/2022-015
              - brly/2022-009
              - brly/2022-010
              - brly/2022-012
              - brly/2021-046
          incident: { const: false }
          aspect: { const: "firmware" }
        required: [ id, incident, aspect ]
        additionalProperties: false
    examples:
      - { id: brly/2021-001-swsmi-len-65529, incident: false, aspect: firmware }
      - { id: brly/rkloader, incident: false, aspect: firmware }
      - { id: brly/2021-025, incident: false, aspect: firmware }
      - { id: brly/2021-037, incident: false, aspect: firmware }
      - { id: brly/2021-035, incident: false, aspect: firmware }
      - { id: brly/2021-032, incident: false, aspect: firmware }
      - { id: brly/2021-023, incident: false, aspect: firmware }
      - { id: brly/2021-029, incident: false, aspect: firmware }
      - { id: brly/intel-bssa-dft, incident: false, aspect: firmware }
      - { id: brly/2021-050, incident: false, aspect: firmware }
      - { id: brly/2021-051, incident: false, aspect: firmware }
      - { id: brly/2021-013, incident: false, aspect: firmware }
      - { id: brly/2021-022, incident: false, aspect: firmware }
      - { id: brly/2021-024, incident: false, aspect: firmware }
      - { id: brly/lojax-secdxe, incident: false, aspect: firmware }
      - { id: brly/usbrt-intel-sa-00057, incident: false, aspect: firmware }
      - { id: brly/2021-005, incident: false, aspect: firmware }
      - { id: brly/2021-021, incident: false, aspect: firmware }
      - { id: brly/moonbounce-core-dxe, incident: false, aspect: firmware }
      - { id: brly/2021-053, incident: false, aspect: firmware }
      - { id: brly/2021-028, incident: false, aspect: firmware }
      - { id: brly/2021-008, incident: false, aspect: firmware }
      - { id: brly/2021-040, incident: false, aspect: firmware }
      - { id: brly/2021-020, incident: false, aspect: firmware }
      - { id: brly/2021-004, incident: false, aspect: firmware }
      - { id: brly/2021-016, incident: false, aspect: firmware }
      - { id: brly/usbrt-cve-2017-5721, incident: false, aspect: firmware }
      - { id: brly/2021-006, incident: false, aspect: firmware }
      - { id: brly/2021-019, incident: false, aspect: firmware }
      - { id: brly/2021-009, incident: false, aspect: firmware }
      - { id: brly/2021-026, incident: false, aspect: firmware }
      - { id: brly/2021-039, incident: false, aspect: firmware }
      - { id: brly/2021-010, incident: false, aspect: firmware }
      - { id: brly/2021-007, incident: false, aspect: firmware }
      - { id: brly/2021-031, incident: false, aspect: firmware }
      - { id: brly/mosaicregressor, incident: false, aspect: firmware }
      - { id: brly/2021-012, incident: false, aspect: firmware }
      - { id: brly/2021-033, incident: false, aspect: firmware }
      - { id: brly/2021-036, incident: false, aspect: firmware }
      - { id: brly/thinkpwn, incident: false, aspect: firmware }
      - { id: brly/2021-014, incident: false, aspect: firmware }
      - { id: brly/2021-018, incident: false, aspect: firmware }
      - { id: brly/2021-038, incident: false, aspect: firmware }
      - { id: brly/2022-004, incident: false, aspect: firmware }
      - { id: brly/especter, incident: false, aspect: firmware }
      - { id: brly/2021-003, incident: false, aspect: firmware }
      - { id: brly/2021-042, incident: false, aspect: firmware }
      - { id: brly/usbrt-swsmi-cve-2020-12301, incident: false, aspect: firmware }
      - { id: brly/2021-043, incident: false, aspect: firmware }
      - { id: brly/2022-028-rsbstuffing, incident: false, aspect: firmware }
      - { id: brly/2021-034, incident: false, aspect: firmware }
      - { id: brly/2021-030, incident: false, aspect: firmware }
      - { id: brly/2021-041, incident: false, aspect: firmware }
      - { id: brly/2021-017, incident: false, aspect: firmware }
      - { id: brly/usbrt-usbsmi-cve-2020-12301, incident: false, aspect: firmware }
      - { id: brly/2021-027, incident: false, aspect: firmware }
      - { id: brly/2021-015, incident: false, aspect: firmware }
      - { id: brly/2021-011, incident: false, aspect: firmware }
      - { id: brly/2021-045, incident: false, aspect: firmware }
      - { id: brly/2021-009-1, incident: false, aspect: firmware }
      - { id: brly/2021-029-1, incident: false, aspect: firmware }
      - { id: brly/2021-010-1, incident: false, aspect: firmware }
      - { id: brly/2021-011-1, incident: false, aspect: firmware }
      - { id: brly/2021-008-1, incident: false, aspect: firmware }
      - { id: brly/2021-001, incident: false, aspect: firmware }
      - { id: brly/2022-027, incident: false, aspect: firmware }
      - { id: brly/2022-014, incident: false, aspect: firmware }
      - { id: brly/2022-011, incident: false, aspect: firmware }
      - { id: brly/2022-013, incident: false, aspect: firmware }
      - { id: brly/2022-016, incident: false, aspect: firmware }
      - { id: brly/2021-047, incident: false, aspect: firmware }
      - { id: brly/2022-015, incident: false, aspect: firmware }
      - { id: brly/2022-009, incident: false, aspect: firmware }
      - { id: brly/2022-010, incident: false, aspect: firmware }
      - { id: brly/2022-012, incident: false, aspect: firmware }
      - { id: brly/2021-046, incident: false, aspect: firmware }

  tpm-endorsement-cert-unverified:
    comment: |
      The EK certificate did not pass muster. Either the certificate could not
      be verified or critical extensions are missing. The issue includes vendor
      and model read from the TPM and, if it could be parsed, the vendor and
      model in the certificate's SAN as well as the TPM spec version implemented.
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "tpm/endorsement-cert-unverified" }
          incident: { const: true }
          aspect: { const: supply-chain }
          args:
            type: object
            properties:
              error:
                enum:
                  # vendor, ek_issuer set
                  - san-invalid
                  # ...and ek_version, ek_manufacturer set
                  - san-mismatch
                  - no-eku
                  # ek_issuer, maybe ek_version, ek_manufacturer set
                  - invalid-certificate
              vendor: { type: string }
              ek_vendor: { type: string }
              ek_version: { type: string }
              ek_issuer: { type: string }
            required: [ error, vendor ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: tpm/endorsement-cert-unverified
        incident: true
        aspect: supply-chain
        args:
          error: san-invalid
          vendor: IFX
          ek_issuer: Infineon AG
      - id: tpm/endorsement-cert-unverified
        incident: true
        aspect: supply-chain
        args:
          error: san-mismatch
          vendor: IFX
          ek_issuer: Infineon AG
          ek_vendor: Infineon AG
          ek_version: 2.00 rev. 102
      - id: tpm/endorsement-cert-unverified
        incident: true
        aspect: supply-chain
        args:
          error: no-eku
          vendor: IFX
          ek_issuer: Infineon AG
          ek_vendor: Infineon AG
          ek_version: 2.00 rev. 102
      - id: tpm/endorsement-cert-unverified
        incident: true
        aspect: supply-chain
        args:
          error: invalid-certificate
          vendor: IFX
          ek_issuer: Infineon AG
          ek_vendor: Infineon AG
          ek_version: 2.00 rev. 102

  csme-downgrade:
    comment: |
      The version reported by the CSME and/or some of its components
      were downgraded from previous attestations. Only downgraded components
      are put into the issue.
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "csme/downgrade" }
          incident: { const: true }
          aspect: { const: "firmware" }
          args:
            type: object
            properties:
              combined: { $ref: "#/$defs/csme-downgrade-component" }
              components:
                type: array
                items: { $ref: "#/$defs/csme-downgrade-component" }
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: 'csme/downgrade'
        incident: true
        aspect: 'firmware'
        args:
          combined: { before: '17.2.20', after: '17.0.1.1' }
          components:
            - { name: 'RBE Manifest', before: '17.2.20', after: '17.0.1.1' }
  csme-downgrade-component:
    type: object
    properties:
      name: { type: string }
      before: { type: string }
      after: { type: string }
    required: [ before, after ]
    additionalProperties: false

  csme-no-update:
    comment: |
      CSME measurments change but no version bump. Arguments are version
      strings from the last attestation (before) and now (after).
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "csme/no-update" }
          incident: { const: true }
          aspect: { const: "firmware" }
          args:
            type: object
            properties:
              components:
                type: array
                items: { $ref: "#/$defs/csme-no-update-component" }
            required: [ components ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: csme/no-update
        aspect: firmware
        incident: true
        args:
          components:
            - before: 87428fc522803d31065e7bce3cf03fe475096631e5e07bbd7a0fde60c4cf25c7
              after: 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
              name: Intel RBE Manifest
              version: 17.2.2.1234
  csme-no-update-component:
    type: object
    properties:
      name: { type: string }
      version: { type: string }
      before: { type: string }
      after: { type: string }
    required: [ before, after, name, version ]
    additionalProperties: false

  uefi-no-exit-boot-srv:
    comment: |
      No ExitBootServices() called.
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "uefi/no-exit-boot-srv" }
          incident: { const: false }
          aspect: { const: "firmware" }
          args:
            type: object
            properties:
              entered: { type: boolean }
            required: [ entered ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
     - id: uefi/no-exit-boot-srv
       incident: false
       aspect: firmware
       args: { entered: true }

  uefi-ibb-no-update:
    comment: |
      The IBB hash changed w/o the UEFI version or release date changing.
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "uefi/ibb-no-update" }
          incident: { const: true }
          aspect: { const: "firmware" }
          args:
            type: object
            properties:
              vendor: { type: string }
              version: { type: string }
              release_date: { type: string }
              before: { type: string }
              after: { type: string }
            required: [ vendor, version, release_date, before, after ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: uefi/ibb-no-update
        incident: true
        aspect: firmware
        args:
          vendor: AMI
          version: 1.2.3
          release_date: 22/11/22
          before: 87428fc522803d31065e7bce3cf03fe475096631e5e07bbd7a0fde60c4cf25c7
          after: 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
 
  uefi-gpt-changed:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "uefi/gpt-changed" }
          incident: { const: true }
          aspect: { const: "bootloader" }
          args:
            type: object
            properties:
              guid: { type: string }
              before: { type: string }
              after: { type: string }
              partitions:
                type: array
                items: { $ref: "#/$defs/uefi-gpt-changed-partition" }
            required: [ before, after, guid, partitions ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: uefi/gpt-changed
        incident: true
        aspect: bootloader
        args:
          guid: 33FD7786-4E80-479F-9DA6-0A5BEC3F6C33
          before: 87428fc522803d31065e7bce3cf03fe475096631e5e07bbd7a0fde60c4cf25c7
          after: 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
          partitions:
            - guid: 33FD7786-4E80-479F-9DA6-0A5BEC3F6C33
              type: 6C53E76C-6A87-461D-B070-6E460A67CA2D
              name:
              start: a
              end: fffffffff
  uefi-gpt-changed-partition:
    type: object
    properties:
      start: { type: string }
      end: { type: string }
      type: { type: string }
      guid: { type: string }
      name: { type: string }
    required: [ start, end, type, guid ]
    additionalProperties: false
 
  uefi-option-rom-set:
    comment: |
      PCI option ROMs were either added, deleted or their measurements changed.
      All three arguments are lists of strings.
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "uefi/option-rom-set" }
          incident: { const: true }
          aspect: { const: "firmware" }
          args:
            type: object
            properties:
              devices:
                type: array
                items: { $ref: "#/$defs/uefi-option-rom-set-device" }
            required: [ devices ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: uefi/option-rom-set
        incident: true
        aspect: firmware
        args:
          devices:
            - before: 87428fc522803d31065e7bce3cf03fe475096631e5e07bbd7a0fde60c4cf25c7
              after: 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
              address: 0000:c1:03.1
              vendor: Intel
              name: Sunrise Point
  uefi-option-rom-set-device:
    type: object
    properties:
      before: { type: string }
      after: { type: string }
      address: { type: string }
      vendor: { type: string }
      name: { type: string }
    required: [ before, after, vendor, name ]
    additionalProperties: false
 
  uefi-boot-app-set:
    comment: |
      UEFI Boot applications were either added, removed or their hash changed.
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "uefi/boot-app-set" }
          incident: { const: true }
          aspect: { const: "bootloader" }
          args:
            type: object
            properties:
              apps:
                type: array
                items: { $ref: "#/$defs/uefi-boot-app-set-app" }
            required: [ apps ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: uefi/boot-app-set
        incident: true
        aspect: bootloader
        args:
          apps:
            - path: 'C:\\EFI\\HDD1\\Windows.efi'
              before: 87428fc522803d31065e7bce3cf03fe475096631e5e07bbd7a0fde60c4cf25c7
              after: 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
  uefi-boot-app-set-app:
    type: object
    properties:
      path: { type: string }
      before: { type: string }
      after: { type: string }
    required: [ before, after, path ]
    additionalProperties: false

  uefi-boot-order:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "uefi/boot-order" }
          incident: { const: true }
          aspect: { const: "configuration" }
          args:
            type: object
            properties:
              variables:
                type: array
                items: { $ref: "#/$defs/uefi-boot-order-variable" }
            required: [ variables ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: uefi/boot-order
        incident: true
        aspect: configuration
        args:
          variables:
            - name: 'C:\\Boot\\Boot1.efi'
              before: 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
              after: 7058299627365fc7a3dd7840fd3d56f29306cd30c0f2c13cb500fe79617290ff
            - name: 'C:\\Boot\\Boot2.efi'
              before: 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
              after: 7058299627365fc7a3dd7840fd3d56f29306cd30c0f2c13cb500fe79617290ff
            - name: 'C:\\Boot\\Boot3.efi'
              before: 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
              after: 7058299627365fc7a3dd7840fd3d56f29306cd30c0f2c13cb500fe79617290ff
  uefi-boot-order-variable:
    type: object
    properties:
      name: { type: string }
      before: { type: string }
      after: { type: string }
    required: [ before, after, name ]
    additionalProperties: false

  uefi-secure-boot-variables:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "uefi/secure-boot-variables" }
          incident: { const: true }
          aspect: { const: "configuration" }
          args:
            type: object
            properties:
              setup_mode: { type: string }
              audit_mode: { type: string }
              deployed_mode: { type: string }
              secure_boot: { type: string }
            required: [ setup_mode, audit_mode, deployed_mode, secure_boot ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: uefi/secure-boot-variables
        incident: true
        aspect: configuration
        args:
          secure_boot: '0'
          setup_mode: '0'
          audit_mode: ''
          deployed_mode: '1'

  uefi-secure-boot-dbx:
    comment: |
      Entries were removed from the dbx since the last attestation.
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "uefi/secure-boot-dbx" }
          incident: { const: true }
          aspect: { const: "configuration" }
          args:
            type: object
            properties:
              fprs:
                type: array
                items: { type: string }
            required: [ fprs ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: uefi/secure-boot-dbx
        incident: true
        aspect: configuration
        args:
          fprs:
            - 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
            - 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
            - 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
            - 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
            - 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
            - 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
            - 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
            - 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
            - 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
            - 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
            - 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f

  uefi-official-dbx:
    comment: |
      Entries in the official dbx are missing from the booted one.
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "uefi/official-dbx" }
          incident: { const: false }
          aspect: { const: "configuration" }
          args:
            type: object
            properties:
              fprs:
                type: array
                items: { type: string }
            required: [ fprs ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: uefi/official-dbx
        incident: false
        aspect: configuration
        args:
          fprs:
            - 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
            - 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
            - 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f

  uefi-boot-failure:
    comment: |
      At least one of the post authority separators in PCR 0-7 are not zero.
      The issue includes all separator values, not just the non zero ones.
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "uefi/boot-failure" }
          incident: { const: true }
          aspect: { const: "firmware" }
          args:
            type: object
            properties:
              pcr0: { type: string }
              pcr1: { type: string }
              pcr2: { type: string }
              pcr3: { type: string }
              pcr4: { type: string }
              pcr5: { type: string }
              pcr6: { type: string }
              pcr7: { type: string }
            required: [ pcr0, pcr1, pcr2, pcr3, pcr4, pcr5, pcr6, pcr7 ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: uefi/boot-failure
        incident: true
        aspect: firmware
        args:
          pcr0: '00000001'
          pcr1: '00000000'
          pcr2: '00000000'
          pcr3: '00000000'
          pcr4: '00000000'
          pcr5: '00000000'
          pcr6: '00000000'
          pcr7: '00000000'

  grub-boot-changed:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "grub/boot-changed" }
          incident: { const: true }
          aspect: { const: "bootloader" }
          args:
            type: object
            properties:
              before: { $ref: "#/$defs/grub-boot-changed-config" }
              after: { $ref: "#/$defs/grub-boot-changed-config" }
            required: [ before, after ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: grub/boot-changed
        incident: true
        aspect: bootloader
        args:
          before:
            kernel: '0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f'
            kernel_path: '(hd0,0)/boot/vmlinux-5.12.0-ubuntu12'
            command_line: ['root=/dev/sda1', 'acpioff', 'swap=/dev/sdb']
            initrd: '0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f'
            initrd_path: '(hd0,0)/boot/initrd-5.12.0-ubuntu12'
          after:
            kernel: '7058299627365fc7a3dd7840fd3d56f29306cd30c0f2c13cb500fe79617290ff'
            kernel_path: '(hd0,0)/boot/vmlinux-5.13.0-ubuntu12'
            command_line: ['root=/dev/sda1', 'acpioff', 'swap=/dev/sdb']
            initrd: '7058299627365fc7a3dd7840fd3d56f29306cd30c0f2c13cb500fe79617290ff'
            initrd_path: '(hd0,0)/boot/initrd-5.13.0-ubuntu12'
  grub-boot-changed-config:
    type: object
    properties:
      initrd: { type: string }
      kernel: { type: string }
      command_line:
        type: array
        items: { type: string }
      initrd_path: { type: string }
      kernel_path: { type: string }
    required: [ initrd, initrd_path, kernel, kernel_path, command_line ]
    additionalProperties: false

  tpm-no-eventlog:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: tpm/no-eventlog }
          incident: { const: true }
          aspect: { const: firmware }
          args:
            type: object
            required: []
            additionalProperties: false
        required: [ id, incident, aspect ]
        additionalProperties: false
    examples:
      - id: tpm/no-eventlog
        incident: true
        aspect: firmware

  tpm-dummy:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "tpm/dummy" }
          incident: { const: true }
          aspect: { const: "supply-chain" }
          args:
            type: object
            required: []
            additionalProperties: false
        required: [ id, incident, aspect ]
        additionalProperties: false
    examples:
      - id: tpm/dummy
        incident: true
        aspect: supply-chain

  eset-disabled:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "eset/disabled" }
          incident: { const: true }
          aspect: { const: "endpoint-protection" }
        required: [ id, incident, aspect ]
        additionalProperties: false
    examples:
      - id: eset/disabled
        incident: true
        aspect: endpoint-protection

  eset-not-started:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "eset/not-started" }
          incident: { const: true }
          aspect: { const: "endpoint-protection" }
          args:
            type: object
            properties:
              components:
                type: array
                items: { $ref: "#/$defs/eset-not-started-component" }
            required: [ components ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: eset/not-started
        incident: true
        aspect: endpoint-protection
        args:
          components:
            - { path: /opt/eset/EAgent, started: false }
            - { path: /opt/eset/libexec/x86_64-linux-gnu/blah-blub, started: true }
            - { path: /opt/eset/blag, started: false }
            - { path: /opt/eset/lib/modules/eset_rtp.ko, started: true }
            - { path: /opt/eset/bin/blub, started: false }
  eset-not-started-component:
    type: object
    properties:
      path: { type: string }
      started: { type: boolean }
    required: [ started, path ]
    additionalProperties: false

  eset-excluded-set:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "eset/excluded-set" }
          incident: { const: true }
          aspect: { const: "endpoint-protection" }
          args:
            type: object
            properties:
              files:
                type: array
                items: { type: string }
              processes:
                type: array
                items: { type: string }
            required: [ files, processes ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: eset/excluded-set
        aspect: endpoint-protection
        incident: true
        args:
          files:
            - /opt/eset/EAgent
            - /opt/eset/EAgent
            - /opt/eset/EAgent
            - /opt/eset/EAgent
            - /opt/eset/EAgent
          processes: ['/bin/bash', '/bin/bash', '/bin/bash', '/bin/bash', '/bin/bash']

  eset-manipulated:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "eset/manipulated" }
          incident: { const: true }
          aspect: { const: "endpoint-protection" }
          args:
            type: object
            properties:
              components:
                type: array
                items: { $ref: "#/$defs/eset-manipulated-file" }
            required: [ components ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: eset/manipulated
        incident: true
        aspect: endpoint-protection
        args:
          components:
            - path: /opt/eset/EAgent
              before: 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
              after: 7058299627365fc7a3dd7840fd3d56f29306cd30c0f2c13cb500fe79617290ff
  eset-manipulated-file:
    type: object
    properties:
      path: { type: string }
      before: { type: string }
      after: { type: string }
    required: [ before, after, path ]
    additionalProperties: false

  tpm-invalid-eventlog:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "tpm/invalid-eventlog" }
          incident: { const: true }
          aspect: { const: "firmware" }
          args:
            type: object
            properties:
              error:
                enum:
                  - format-invalid
                  # pcrs set
                  - pcr-mismatch
              pcr:
                type: array
                items: { $ref: "#/$defs/tpm-invalid-eventlog-pcr" }
            required: [ error ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
  tpm-invalid-eventlog-pcr:
    type: object
    properties:
      computed: { type: string }
      quoted: { type: string }
      number: { type: string }
    required: [ number ]
    additionalProperties: false

  windows-boot-config:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "windows/boot-config" }
          incident: { const: false }
          aspect: { const: "operating-system" }
          args:
            type: object
            properties:
              boot_debugging: { type: boolean }
              kernel_debugging: { type: boolean }
              dep_disabled: { type: boolean }
              code_integrity_disabled: { type: boolean }
              test_signing: { type: boolean }
            required: [ boot_debugging, kernel_debugging, dep, code_integrity, test_signing ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: windows/boot-config
        incident: false
        aspect: operating-system
        args:
          boot_debugging: false
          kernel_debugging: false
          dep_disabled: false
          code_integrity_disabled: false
          test_signing: false

  windows-boot-log-quotes:
    comment: |
      Trust points in WBCL don't match up.
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "windows/boot-log" }
          incident: { const: true }
          aspect: { const: "operating-system" }
          args:
            type: object
            properties:
              error:
                enum:
                  - missing-trust-point
                  - wrong-format
                  - wrong-signature
                  - wrong-quote 
              log: { type: integer }
            required: [ error ]
            additionalProperties: false
        required: [ id, incident, aspect ]
        additionalProperties: false
    examples:
      - id: windows/boot-log
        incident: true
        aspect: operating-system
        args:
          error: missing-trust-point
          log: 2
      - id: windows/boot-log
        incident: true
        aspect: operating-system
        args:
          error: wrong-format
          log: 2
      - id: windows/boot-log
        incident: true
        aspect: operating-system
        args:
          error: wrong-signature
          log: 2
      - id: windows/boot-log
        incident: true
        aspect: operating-system
        args:
          error: wrong-quote
          log: 2

  windows-boot-counter-replay:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "windows/boot-counter-replay" }
          incident: { const: true }
          aspect: { const: "operating-system" }
          args:
            type: object
            properties:
              latest: { type: string }
              received: { type: string }
            required: [ latest, received ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: windows/boot-counter-replay
        incident: true
        aspect: operating-system
        args:
          latest: '8'
          received: '2'

  ima-runtime-measurements:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "ima/runtime-measurements" }
          incident: { const: true }
          aspect: { const: "endpoint-protection" }
          args:
            type: object
            properties:
              files:
                type: array
                items: { $ref: "#/$defs/ima-runtime-measurements-file" }
            required: [ files ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: ima/runtime-measurements
        incident: true
        aspect: endpoint-protection
        args:
          files:
            - path: /opt/eset/EAgent
              before: 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
              after: 7058299627365fc7a3dd7840fd3d56f29306cd30c0f2c13cb500fe79617290ff
  ima-runtime-measurements-file:
    type: object
    properties:
      path: { type: string }
      before: { type: string }
      after: { type: string }
    required: [ path, before, after ]
    additionalProperties: false

  ima-invalid-log:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "ima/invalid-log" }
          incident: { const: true }
          aspect: { const: "endpoint-protection" }
          args:
            type: object
            properties:
              pcr:
                type: array
                items: { $ref: "#/$defs/ima-invalid-log-pcr" }
            required: [ pcr ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: ima/invalid-log
        incident: true
        aspect: endpoint-protection
        args:
          pcr:
            - number: '13'
              computed: 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
              quoted: 7058299627365fc7a3dd7840fd3d56f29306cd30c0f2c13cb500fe79617290ff
            - number: '12'
              computed: 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
              quoted: 7058299627365fc7a3dd7840fd3d56f29306cd30c0f2c13cb500fe79617290ff
  ima-invalid-log-pcr:
    type: object
    properties:
      computed: { type: string }
      number: { type: string }
      quoted: { type: string }
    required: [ computed, quoted, number ]
    additionalProperties: false

  ima-boot-aggregate:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "ima/boot-aggregate" }
          incident: { const: true }
          aspect: { const: "endpoint-protection" }
          args:
            type: object
            properties:
              computed: { type: string }
              logged: { type: string }
            required: [ computed, logged ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: ima/boot-aggregate
        incident: true
        aspect: endpoint-protection
        args:
          computed: 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
          logged: 7058299627365fc7a3dd7840fd3d56f29306cd30c0f2c13cb500fe79617290ff

  uefi-secure-boot-keys:
    comment: |
      PK and/or KEK changed. The issue includes all KEKs and the PK. All keys
      are assumed to be X.509 certificates.
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "uefi/secure-boot-keys" }
          incident: { const: true }
          aspect: { const: "firmware" }
          args:
            type: object
            properties:
              pk: { $ref: "#/$defs/uefi-secure-boot-keys-certificate" }
              kek:
                type: array
                items: { $ref: "#/$defs/uefi-secure-boot-keys-certificate" }
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: 'uefi/secure-boot-keys'
        incident: true
        aspect: 'firmware'
        args:
          pk:
            subject: CN=SUSE Linux Enterprise Secure Boot CA,OU=Build Team,O=SUSE Linux Products GmbH,L=Nuremberg,C=DE,1.2.840.113549.1.9.1=#0c
            issuer: CN=Microsoft Root Certificate Authority 2010,O=Microsoft Corporation,L=Redmond,ST=Washington,C=US
            not_before: 1985-04-12T23:20:50.52Z
            not_after: 1985-04-12T23:20:50.52Z
            fpr: 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
          kek:
            - subject: CN=SUSE Linux Enterprise Secure Boot CA,OU=Build Team,O=SUSE Linux Products GmbH,L=Nuremberg,C=DE,1.2.840.113549.1.9.1=#0c
              issuer: CN=Microsoft Root Certificate Authority 2010,O=Microsoft Corporation,L=Redmond,ST=Washington,C=US
              not_before: 1985-04-12T23:20:50.52Z
              not_after: 1985-04-12T23:20:50.52Z
              fpr: 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
            - subject: CN=SUSE Linux Enterprise Secure Boot CA,OU=Build Team,O=SUSE Linux Products GmbH,L=Nuremberg,C=DE,1.2.840.113549.1.9.1=#0c
              issuer: CN=Microsoft Root Certificate Authority 2010,O=Microsoft Corporation,L=Redmond,ST=Washington,C=US
              not_before: 1985-04-12T23:20:50.52Z
              not_after: 1985-04-12T23:20:50.52Z
              fpr: '0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f'
            - subject: CN=SUSE Linux Enterprise Secure Boot CA,OU=Build Team,O=SUSE Linux Products GmbH,L=Nuremberg,C=DE,1.2.840.113549.1.9.1=#0c
              issuer: CN=Microsoft Root Certificate Authority 2010,O=Microsoft Corporation,L=Redmond,ST=Washington,C=US
              not_before: 1985-04-12T23:20:50.52Z
              not_after: 1985-04-12T23:20:50.52Z
              fpr: 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
  uefi-secure-boot-keys-certificate:
    type: object
    properties:
      issuer: { type: string }
      subject: { type: string }
      fpr: { type: string }
      not_before: { type: string }
      not_after: { type: string }
    required: [ issuer, subject, fpr, not_before, not_after ]
    additionalProperties: false

  policy-endpoint-protection:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "policy/endpoint-protection" }
          incident: { const: true }
          aspect: { const: "endpoint-protection" }
        required: [ id, incident, aspect ]
        additionalProperties: false
    examples:
      - id: policy/endpoint-protection
        aspect: endpoint-protection
        incident: true

  policy-intel-tsc:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "policy/intel-tsc" }
          incident: { const: true }
          aspect: { const: "supply-chain" }
        required: [ id, incident, aspect ]
        additionalProperties: false
    examples:
      - id: policy/intel-tsc
        aspect: supply-chain
        incident: true

  tsc-endorsement-certificate:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "tsc/endorsement-certificate" }
          incident: { const: true }
          aspect: { const: "supply-chain" }
          args:
            type: object
            properties:
              error:
                enum:
                  # ek_serial, holder_serial
                  - holder-issuer
                  # ek_issuer, holder_issuer
                  - xml-serial
                  - holder-serial
              holder_issuer: { type: string }
              holder_serial: { type: string }
              xml_serial: { type: string }
              ek_issuer: { type: string }
              ek_serial: { type: string }
            required: [ issuer, subject, not_before, not_after, error ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: tsc/endorsement-certificate
        aspect: supply-chain
        incident: true
        args:
          error: xml-serial
          xml_serial: '026382998'
          ek_serial: '026382998'
          holder_serial: '7058299'
          holder_issuer: CN=SUSE Linux Enterprise Secure Boot CA,OU=Build Team,O=SUSE Linux Products GmbH,L=Nuremberg,C=DE,1.2.840.113549.1.9.1=#0c
          ek_issuer: CN=Microsoft Root Certificate Authority 2010,O=Microsoft Corporation,L=Redmond,ST=Washington,C=US
      - id: tsc/endorsement-certificate
        aspect: supply-chain
        incident: true
        args:
          error: holder-issuer
          xml_serial: '026382998'
          ek_serial: '026382998'
          holder_serial: '7058299'
          holder_issuer: CN=SUSE Linux Enterprise Secure Boot CA,OU=Build Team,O=SUSE Linux Products GmbH,L=Nuremberg,C=DE,1.2.840.113549.1.9.1=#0c
          ek_issuer: CN=Microsoft Root Certificate Authority 2010,O=Microsoft Corporation,L=Redmond,ST=Washington,C=US
      - id: tsc/endorsement-certificate
        incident: true
        aspect: supply-chain
        args:
          error: holder-serial
          xml_serial: '026382998'
          ek_serial: '026382998'
          holder_serial: '7058299'
          holder_issuer: CN=SUSE Linux Enterprise Secure Boot CA,OU=Build Team,O=SUSE Linux Products GmbH,L=Nuremberg,C=DE,1.2.840.113549.1.9.1=#0c
          ek_issuer: CN=Microsoft Root Certificate Authority 2010,O=Microsoft Corporation,L=Redmond,ST=Washington,C=US

  firmware-update:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "fw/update" }
          incident: { const: false }
          aspect: { const: "firmware" }
          args:
            type: object
            properties:
              updates:
                type: array
                items: { $ref: "#/$defs/firmware-update-updates" }
            required: [ updates ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: fw/update
        incident: false
        aspect: firmware
        args:
          updates:
            - name: UEFI DBX
              current: '77'
              next: '122'
            - name: UEFI DBX
              current: '77'
              next: '122'
            - name: UEFI DBX
              current: '77'
              next: '122'
            - name: UEFI DBX
              current: '77'
              next: '122'
  firmware-update-updates:
    type: object
    properties:
      name: { type: string }
      current: { type: string }
      next: { type: string }
    required: [ name, current, next ]
    additionalProperties: false

  tsc-pcr-values:
    comment: |
      XXX
    allOf:
      - $ref: "#/$defs/common"
      - type: object
        properties:
          id: { const: "tsc/pcr-values" }
          incident: { const: true }
          aspect: { const: "supply-chain" }
          args:
            type: object
            properties:
              values:
                type: array
                items: { $ref: "#/$defs/tsc-pcr-values-pcr" }
            required: [ values ]
            additionalProperties: false
        required: [ id, incident, aspect, args ]
        additionalProperties: false
    examples:
      - id: tsc/pcr-values
        incident: true
        aspect: supply-chain
        args:
          values:
            - tsc: 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
              quoted: 7058299627365fc7a3dd7840fd3d56f29306cd30c0f2c13cb500fe79617290ff
              number: '0'
            - tsc: 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
              quoted: 7058299627365fc7a3dd7840fd3d56f29306cd30c0f2c13cb500fe79617290ff
              number: '0'
            - tsc: 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
              quoted: 7058299627365fc7a3dd7840fd3d56f29306cd30c0f2c13cb500fe79617290ff
              number: '0'
            - tsc: 0263829989b6fd954f72baaf2fc64bc2e2f01d692d4de72986ea808f6e99813f
              quoted: 7058299627365fc7a3dd7840fd3d56f29306cd30c0f2c13cb500fe79617290ff
              number: '0'
  tsc-pcr-values-pcr:
    type: object
    properties:
      tsc: { type: string }
      quoted: { type: string }
      number: { type: string }
    required: [ tsc, quoted, number ]
    additionalProperties: false
